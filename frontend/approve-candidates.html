<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Approve Candidates | OVS</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="form.css">
</head>
<body>
  <!-- Navbar -->
  <nav>
    <div class="logo">üó≥Ô∏è OVS</div>
    <ul>
      <li><a href="admin-dashboard.html">Dashboard</a></li>
      <li><a href="add-party.html">Add Party</a></li>
      <li><a href="add-election.html">Add Election</a></li>
      <li><a href="approve-voters.html">Approve Voters</a></li>
      <li><a href="approve-candidates.html" class="active">Approve Candidates</a></li>
      <li><a href="results.html">View Results</a></li>
      <li><a href="#" id="logoutBtn">Logout</a></li>
    </ul>
  </nav>

  <!-- Content -->
  <div class="overlay">
    <h2>Pending Candidates</h2>
    <table id="candidatesTable" border="1" cellpadding="10" cellspacing="0" style="width:100%; color:#000;">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Party</th>
          <th>Position</th>
          <th>Election</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <!-- Candidates will be loaded here -->
      </tbody>
    </table>
    <p id="msg"></p>
  </div>

  <footer>
    ¬© 2025 Online Voting System | Admin Panel
  </footer>

  <script>
    // Logout
    document.getElementById("logoutBtn").addEventListener("click", () => {
      localStorage.removeItem("adminUser");
      window.location.href = "admin-login.html";
    });

    // Load pending candidates
    async function loadCandidates() {
      try {
        const res = await fetch("http://localhost:8080/admin/candidates/pending");
        const candidates = await res.json();
        const tbody = document.querySelector("#candidatesTable tbody");
        tbody.innerHTML = "";

        candidates.forEach(c => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${c.Candidate_ID}</td>
            <td>${c.Name}</td>
            <td>${c.Party_Name || "Independent"}</td>
            <td>${c.Position}</td>
            <td>${c.Election_Name}</td>
            <td>
              <button onclick="approve(${c.Candidate_ID})">Approve</button>
              <button onclick="reject(${c.Candidate_ID})">Reject</button>
            </td>
          `;
          tbody.appendChild(row);
        });
      } catch (err) {
        document.getElementById("msg").textContent = "Error loading candidates.";
      }
    }

    // Approve candidate
    async function approve(id) {
      try {
        const res = await fetch(`http://localhost:8080/admin/candidate/approve/${id}`, { method: "POST" });
        const msg = await res.text();
        document.getElementById("msg").textContent = msg;
        loadCandidates();
      } catch {
        document.getElementById("msg").textContent = "Error approving candidate.";
      }
    }

    // Reject candidate
    async function reject(id) {
      try {
        const res = await fetch(`http://localhost:8080/admin/candidate/reject/${id}`, { method: "POST" });
        const msg = await res.text();
        document.getElementById("msg").textContent = msg;
        loadCandidates();
      } catch {
        document.getElementById("msg").textContent = "Error rejecting candidate.";
      }
    }

    // Initial load
    loadCandidates();
  </script>
</body>
</html>
