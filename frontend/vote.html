<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cast Your Vote | OVS</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="form.css">
</head>
<body>
    <!-- Navbar -->
    <nav>
        <div class="logo">üó≥Ô∏è OVS</div>
        <div class="hamburger">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="voter-login.html">Voter</a></li>
            <li><a href="candidate-login.html">Candidate</a></li>
            <li><a href="admin-login.html">Admin</a></li>
            <li><a href="results.html">Results</a></li>
        </ul>
    </nav>

    <!-- Overlay + Page Content -->
    <div class="overlay">
        <h2>Cast Your Vote</h2>
        <form id="voteForm">
            <label for="candidate">Select Candidate:</label>
            <select id="candidate" required>
                <option value="">Loading candidates‚Ä¶</option>
            </select>
            <button type="submit">Submit Vote</button>
        </form>
        <p id="message"></p>
    </div>

    <!-- Footer -->
    <footer>
        ¬© 2025 Online Voting System | All Rights Reserved
    </footer>

    <!-- Script -->
    <script>
        // Load candidates on page load
        function fetchCandidates() {
            fetch('http://localhost:8080/candidates/all')
                .then(response => response.json())
                .then(data => {
                    let select = document.getElementById('candidate');
                    select.innerHTML = ""; // Clear placeholder
                    data.forEach(c => {
                        var option = document.createElement('option');
                        option.value = c.candidateId;
                        option.textContent = c.name;
                        select.appendChild(option);
                    });
                })
                .catch(() => {
                    document.getElementById('candidate').innerHTML = "<option value=''>Failed to load candidates</option>";
                });
        }

        // Submit vote, uses session (no voterId needed)
        document.getElementById('voteForm').addEventListener('submit', function (e) {
            e.preventDefault();
            let candidateId = parseInt(document.getElementById('candidate').value, 10);
            let electionId = 1; // Use your actual electionId

            if (!candidateId) {
                document.getElementById('message').textContent = "Please select a candidate.";
                return;
            }

            fetch('http://localhost:8080/votes/cast', {
                method: 'POST',
                credentials: 'include', // For session cookie
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ candidateId: candidateId, electionId: electionId })
            })
            .then(response => response.text())
            .then(data => {
                document.getElementById('message').innerText = data;
            })
            .catch(err => {
                document.getElementById('message').innerText = "Error: " + err;
            });
        });

        fetchCandidates();
    </script>
    <script src="navbar.js"></script>
</body>
</html>
